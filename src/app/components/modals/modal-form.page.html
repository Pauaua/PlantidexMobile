<ion-header>
  <ion-toolbar color="primary">
    <ion-title>{{ tipo === 'usuario' ? (usuario ? 'Editar usuario' : 'Nuevo usuario') : (especie ? 'Editar especie' : 'Nueva especie') }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrar()" color="danger">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="form" (ngSubmit)="guardar()">
    <ng-container *ngIf="tipo === 'usuario'">
      <ion-item>
        <ion-label position="floating">Nombre</ion-label>
        <ion-input formControlName="nombre"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Email</ion-label>
        <ion-input type="email" formControlName="email"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Contraseña</ion-label>
        <ion-input type="password" formControlName="password"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label>Rol</ion-label>
        <ion-select formControlName="rol">
          <ion-select-option value="usuario">Usuario</ion-select-option>
          <ion-select-option value="admin">Admin</ion-select-option>
        </ion-select>
      </ion-item>
    </ng-container>
    <ng-container *ngIf="tipo === 'especie'">
      <ion-item>
        <ion-label position="floating">Nombre común</ion-label>
        <ion-input formControlName="nombreComun"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Reportado por</ion-label>
        <ion-input formControlName="reportadoPor"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Descripción</ion-label>
        <ion-input formControlName="descripcion"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label>¿Aprobada?</ion-label>
        <ion-toggle formControlName="aprobada"></ion-toggle>
      </ion-item>
      <ion-item>
        <ion-label>Foto actual</ion-label>
        <img *ngIf="form.get('foto')?.value" [src]="form.get('foto')?.value" alt="Foto especie" style="width:64px; height:64px; object-fit:cover; border-radius:8px; margin-left:12px;" />
        <span *ngIf="!form.get('foto')?.value" style="color:#888; margin-left:12px;">Sin foto</span>
      </ion-item>
      <ion-item>
        <ion-button expand="block" color="primary" (click)="cambiarFoto()">Cambiar foto</ion-button>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Latitud</ion-label>
        <ion-input type="number" formControlName="lat"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Longitud</ion-label>
        <ion-input type="number" formControlName="lng"></ion-input>
      </ion-item>
    </ng-container>
    <ion-button expand="block" color="success" class="ion-margin-top" type="submit" [disabled]="form.invalid">
      Guardar
    </ion-button>
  </form>
</ion-content>
